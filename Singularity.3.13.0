Bootstrap:docker
From:gcc:6.5.0


%labels
MAINTAINER severin@iastate.edu
APPLICATION SPAdes

%help
This container contains all the necessary programs to run SPAdes
See https://github.com/ISUGIFsingularity/spades.git for more inforation

%environment
source /etc/profile.d/modules.sh
SPACK_ROOT=/opt/spack
export SPACK_ROOT
export PATH=$SPACK_ROOT/bin:$PATH
source /etc/profile.d/modules.sh
source $SPACK_ROOT/share/spack/setup-env.sh

module load python
module load spades




%post
# Speed up yum
yum install -y yum-plugin-fastestmirror
yum install -y deltarpm

export SPACK_ROOT=/opt/spack
export SPACK_ROOT
export PATH=$SPACK_ROOT/bin:$PATH

#spack dependencies
yum -y install git python \
gcc gcc-c++ gcc-gfortran curl \
gnupg2 sed patch \
unzip gzip bzip2 \
findutils make vim \
bc paste wget \
environment-modules

yum clean all

#get spack
git clone https://github.com/spack/spack.git $SPACK_ROOT


yum clean all

export FORCE_UNSAFE_CONFIGURE=1

source $SPACK_ROOT/share/spack/setup-env.sh


#bzip.org is down, dfetching repo from fossies.org into mirror
#mkdir -p $SPACK_ROOT/mirror/bzip2
#spack mirror add local $SPACK_ROOT/mirror
#pushd $SPACK_ROOT/mirror/bzip2
#wget https://fossies.org/linux/misc/bzip2-1.0.6.tar.gz
#popd


spack install spades@3.13.0





cd $SPACK_ROOT

%runscript
