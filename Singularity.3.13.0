Bootstrap:docker
From:centos:7

%labels
MAINTAINER severin@iastate.edu
spack

%environment
SPACK_ROOT=/opt/spack
export SPACK_ROOT
export PATH=$SPACK_ROOT/bin:$PATH
source /etc/profile.d/modules.sh
source $SPACK_ROOT/share/spack/setup-env.sh

module load spades

%post
export SPACK_ROOT=/opt/spack
export SPACK_ROOT
export PATH=$SPACK_ROOT/bin:$PATH

# Speed up yum
yum install -y yum-plugin-fastestmirror
yum install -y deltarpm

#spack dependencies
yum -y install git python \
gcc gcc-c++ gcc-gfortran curl \
gnupg2 sed patch \
unzip gzip bzip2 \
findutils make vim \
environment-modules

yum clean all

#get spack
git clone https://github.com/spack/spack.git $SPACK_ROOT

#setup compilers.yaml
spack compiler find --scope system $(which gcc)
spack compiler find --scope system $(which g++)
spack compiler find --scope system $(which gfortran)

#setup modules config file
echo "modules:" >> /opt/spack/etc/spack/modules.yaml
echo "  tcl:" >> /opt/spack/etc/spack/modules.yaml
echo "    naming_scheme: '\${PACKAGE}/\${VERSION}'" >> /opt/spack/etc/spack/modules.yaml

source $SPACK_ROOT/share/spack/setup-env.sh

%runscript
ls /opt/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/spades-3.13.0-2zrc7eh6resnq36756wrxrljgrrsrc4d/bin 

